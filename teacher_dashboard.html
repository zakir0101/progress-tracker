<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IGCSE Mathematics (0580) Teacher Dashboard</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1400px;
      margin: 20px auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .auth-section {
      background: #e7f3ff;
      padding: 20px;
      border-radius: 8px;
      margin: 20px;
      text-align: center;
      border-left: 4px solid #2c3e50;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .centered {
      margin: 0 auto;
    }

    .auth-section h3 {
      margin-bottom: 15px;
      color: #495057;
    }

    .user-info {
      background: #d4edda;
      padding: 15px 20px;
      border-radius: 8px;
      margin: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid #28a745;
    }

    .user-details {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #28a745;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s ease;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    .dashboard-content {
      padding: 30px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      color: #6c757d;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #2c3e50;
    }

    .stat-change {
      font-size: 0.8rem;
      margin-top: 5px;
    }

    .positive {
      color: #28a745;
    }

    .negative {
      color: #dc3545;
    }

    .students-section {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      overflow: hidden;
    }

    .section-header {
      background: #495057;
      color: white;
      padding: 15px 20px;
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .search-input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
      background: white;
    }

    .students-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .student-card {
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      background: white;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .student-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .student-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .student-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2c3e50;
    }

    .student-email {
      color: #6c757d;
      font-size: 0.9rem;
      margin-top: 2px;
    }

    .progress-bar {
      background: #e9ecef;
      border-radius: 25px;
      height: 20px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(90deg, #28a745, #20c997);
      height: 100%;
      border-radius: 25px;
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.8rem;
    }

    .student-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 0.9rem;
      color: #6c757d;
    }

    .chart-section {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-top: 30px;
    }

    .chart-container {
      height: 300px;
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .status-message {
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      text-align: center;
      font-weight: 500;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .export-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s ease;
    }

    .export-btn:hover {
      background: #0056b3;
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 5px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .dashboard-content {
        padding: 15px;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .students-grid {
        grid-template-columns: 1fr;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .user-info {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>IGCSE Mathematics (0580)</h1>
      <p>Teacher Dashboard - Monitor Student Progress</p>
    </div>

    <!-- Authentication Section -->
    <div class="auth-section" id="authSection">
      <h3>Sign in with Google to access teacher dashboard</h3>
      <div class="centered" id="g_id_onload"
        data-client_id="917775460589-0sb14a7k4rmbdf319evuober7ck655b7.apps.googleusercontent.com" data-context="signin"
        data-ux_mode="popup" data-callback="handleCredentialResponse" data-auto_prompt="false" data-itp_support="true">
      </div>
      <div class="g_id_signin centered" data-type="standard" data-shape="rectangular" data-theme="outline"
        data-text="signin_with" data-size="large" data-logo_alignment="left">
      </div>
      <p style="margin-top: 15px; font-size: 0.9rem; color: #6c757d;">
        <strong>Setup Required:</strong> Replace YOUR_GOOGLE_OAUTH_CLIENT_ID with your actual Google OAuth Client ID
      </p>
    </div>

    <!-- User Info Section -->
    <div class="user-info hidden" id="userInfo">
      <div class="user-details">
        <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
        <div>
          <strong id="userName"></strong>
          <div style="font-size: 0.9rem; color: #6c757d;">
            <span id="userEmail"></span>
          </div>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- Dashboard Content (Hidden until authenticated) -->
    <div id="dashboardContent" class="hidden">
      <div class="dashboard-content">
        <!-- Statistics Overview -->
        <div class="dashboard-grid">
          <div class="stat-card">
            <h3>Total Students</h3>
            <div class="stat-value" id="totalStudents">0</div>
            <div class="stat-change positive" id="studentsChange">+0 this week</div>
          </div>
          <div class="stat-card">
            <h3>Average Progress</h3>
            <div class="stat-value" id="averageProgress">0%</div>
            <div class="stat-change positive" id="progressChange">+0% from last week</div>
          </div>
          <div class="stat-card">
            <h3>Active Submissions</h3>
            <div class="stat-value" id="totalSubmissions">0</div>
            <div class="stat-change positive" id="submissionsChange">+0 today</div>
          </div>
          <div class="stat-card">
            <h3>Completion Rate</h3>
            <div class="stat-value" id="completionRate">0%</div>
            <div class="stat-change positive" id="completionChange">+0% from last month</div>
          </div>
        </div>

        <!-- Students Section -->
        <div class="students-section">
          <div class="section-header">
            <span>Student Progress Overview</span>
            <div class="controls">
              <input type="text" class="search-input" id="searchInput" placeholder="Search students..."
                onkeyup="filterStudents()">
              <select class="filter-select" id="progressFilter" onchange="filterStudents()">
                <option value="all">All Progress</option>
                <option value="0-25">0-25%</option>
                <option value="25-50">25-50%</option>
                <option value="50-75">50-75%</option>
                <option value="75-100">75-100%</option>
              </select>
              <button class="export-btn" onclick="exportData()">Export Data</button>
            </div>
          </div>
          <div class="students-grid" id="studentsGrid">
            <!-- Student cards will be dynamically generated here -->
          </div>
        </div>

        <!-- Charts Section -->
        <div class="chart-section">
          <h3>Progress Distribution</h3>
          <div class="chart-container">
            <canvas id="progressChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="footer"
      style="background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; border-top: 1px solid #e9ecef;">
      <p>IGCSE Mathematics (0580) Teacher Dashboard - Based on 2025-2027 Syllabus</p>
      <p><small>Real-time student progress monitoring and analytics</small></p>
    </div>
  </div>

  <script>
    // Unified API Configuration for Flask Backend
    const API_CONFIG = {
      BASE_URL: '/tracker',
      SESSION_TIMEOUT: 60 * 60 * 1000 // 1 hour in milliseconds
    };

    // Global variables
    let currentUser = null;
    let sessionTimer = null;
    let currentSessionId = null;
    let allStudents = [];
    let progressChart = null;

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function () {
      checkExistingSession();
    });

    // Check for existing user session
    function checkExistingSession() {
      const userSession = localStorage.getItem('igcse_teacher_session');

      if (userSession) {
        try {
          const session = JSON.parse(userSession);
          const now = Date.now();

          // Check if session is still valid
          if (session.expiresAt > now) {
            currentUser = session.user;
            showAuthenticatedUI();
            loadDashboardData();
            startSessionTimer();
            return;
          } else {
            // Session expired
            localStorage.removeItem('igcse_teacher_session');
          }
        } catch (error) {
          console.error('Error parsing user session:', error);
          clearUserSession();
        }
      }

      showAuthenticationUI();
    }

    // Handle Google OAuth response
    function handleCredentialResponse(response) {
      console.log('Google OAuth response received:', response);

      if (!response || !response.credential) {
        console.error('Invalid OAuth response:', response);
        showStatus('Authentication failed: Invalid response from Google. Please try again.', 'error');
        return;
      }

      try {
        // Decode the JWT token to get user info
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        console.log('Decoded JWT payload:', payload);

        currentUser = {
          id: payload.sub,
          name: payload.name,
          email: payload.email,
          picture: payload.picture,
          loginTime: Date.now()
        };

        // Create session with expiration
        const session = {
          user: currentUser,
          expiresAt: Date.now() + API_CONFIG.SESSION_TIMEOUT
        };

        localStorage.setItem('igcse_teacher_session', JSON.stringify(session));

        // Initialize session with backend
        initializeBackendSession();

        showAuthenticatedUI();
        loadDashboardData();
        startSessionTimer();

        showStatus('Successfully signed in! Loading dashboard...', 'success');
      } catch (error) {
        console.error('Authentication error:', error);
        showStatus('Authentication failed: ' + error.message, 'error');
      }
    }

    // Initialize session with backend
    async function initializeBackendSession() {
      try {
        // For now, we'll create a simple session ID
        currentSessionId = 'teacher_session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

        // Optionally load syllabus data for future use
        await loadSyllabusData();
      } catch (error) {
        console.error('Session initialization error:', error);
      }
    }

    // Load syllabus data from Flask backend
    async function loadSyllabusData() {
      try {
        const syllabusUrl = `${API_CONFIG.BASE_URL}/syllabus`;
        const response = await fetch(syllabusUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          }
        });

        if (response.ok) {
          const syllabusData = await response.json();
          console.log('Syllabus data loaded:', syllabusData);
          // Store syllabus data for potential future use
          window.syllabusData = syllabusData;
        }
      } catch (error) {
        console.warn('Failed to load syllabus data:', error);
        // Syllabus data is optional, so don't show error to user
      }
    }

    // Show authentication UI
    function showAuthenticationUI() {
      document.getElementById('authSection').classList.remove('hidden');
      document.getElementById('userInfo').classList.add('hidden');
      document.getElementById('dashboardContent').classList.add('hidden');
    }

    // Show authenticated UI
    function showAuthenticatedUI() {
      if (!currentUser) return;

      document.getElementById('authSection').classList.add('hidden');
      document.getElementById('userInfo').classList.remove('hidden');
      document.getElementById('dashboardContent').classList.remove('hidden');

      // Update user info
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userAvatar').src = currentUser.picture;
    }

    // Logout function
    function logout() {
      if (confirm('Are you sure you want to log out?')) {
        clearUserSession();
        showAuthenticationUI();
        showStatus('Successfully logged out.', 'success');
      }
    }

    // Clear user session
    function clearUserSession() {
      currentUser = null;
      if (sessionTimer) {
        clearTimeout(sessionTimer);
        sessionTimer = null;
      }
      localStorage.removeItem('igcse_teacher_session');
    }

    // Start session timer
    function startSessionTimer() {
      if (sessionTimer) {
        clearTimeout(sessionTimer);
      }

      sessionTimer = setTimeout(() => {
        showStatus('Your session has expired. Please sign in again.', 'warning');
        clearUserSession();
        showAuthenticationUI();
      }, API_CONFIG.SESSION_TIMEOUT);
    }

    // Load dashboard data
    async function loadDashboardData() {
      try {
        // Load all progress data from Flask backend
        const progressUrl = `${API_CONFIG.BASE_URL}/all-progress`;
        const progressResponse = await fetch(progressUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          }
        });

        if (!progressResponse.ok) {
          throw new Error(`HTTP error! status: ${progressResponse.status}`);
        }

        const progressResult = await progressResponse.json();

        // Flask backend returns progress data in format: {status: 'success', data: [...]}
        // Expected format: Array of student progress objects
        // Each object should contain:
        // - name: string (student name)
        // - email: string (student email)
        // - progress_percentage: number
        // - completed_count: number
        // - total_topics: number
        // - last_updated: string (timestamp)
        if (progressResult && progressResult.status === 'success' && Array.isArray(progressResult.data)) {
          // Transform Flask response format to match expected structure
          allStudents = progressResult.data.map(studentProgress => {
            return {
              name: studentProgress.name || 'Unknown Student',
              email: studentProgress.email,
              progress: studentProgress.progress_percentage || 0,
              lastSubmission: studentProgress.last_updated || null,
              totalSubmissions: 1, // Each student has one progress entry
              registration_date: studentProgress.last_updated || new Date().toISOString()
            };
          });

          updateStatistics();
          renderStudentCards();
          renderProgressChart();
        } else {
          throw new Error('Invalid data format received from server');
        }

      } catch (error) {
        console.error('Error loading dashboard data:', error);
        handleBackendError(error);
      }
    }

    // Update statistics
    function updateStatistics() {
      const totalStudents = allStudents.length;
      const studentsWithProgress = allStudents.filter(student => student.progress > 0);
      const averageProgress = studentsWithProgress.length > 0
        ? Math.round(studentsWithProgress.reduce((sum, student) => sum + student.progress, 0) / studentsWithProgress.length)
        : 0;
      const totalSubmissions = allStudents.reduce((sum, student) => sum + student.totalSubmissions, 0);
      const completionRate = totalStudents > 0
        ? Math.round((studentsWithProgress.length / totalStudents) * 100)
        : 0;

      document.getElementById('totalStudents').textContent = totalStudents;
      document.getElementById('averageProgress').textContent = averageProgress + '%';
      document.getElementById('totalSubmissions').textContent = totalSubmissions;
      document.getElementById('completionRate').textContent = completionRate + '%';
    }

    // Render student cards
    function renderStudentCards() {
      const studentsGrid = document.getElementById('studentsGrid');
      studentsGrid.innerHTML = '';

      allStudents.forEach(student => {
        const card = document.createElement('div');
        card.className = 'student-card';
        card.innerHTML = `
                    <div class="student-header">
                        <div>
                            <div class="student-name">${student.name}</div>
                            <div class="student-email">${student.email}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #2c3e50;">${Math.round(student.progress || 0)}%</div>
                            <div style="font-size: 0.8rem; color: #6c757d;">Progress</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${student.progress || 0}%">${Math.round(student.progress || 0)}%</div>
                    </div>
                    <div class="student-stats">
                        <span>Submissions: ${student.totalSubmissions || 0}</span>
                        <span>Last: ${student.lastSubmission ? new Date(student.lastSubmission).toLocaleDateString() : 'Never'}</span>
                    </div>
                `;
        studentsGrid.appendChild(card);
      });
    }

    // Render progress chart
    function renderProgressChart() {
      const ctx = document.getElementById('progressChart').getContext('2d');

      // Destroy existing chart if it exists
      if (progressChart) {
        progressChart.destroy();
      }

      // Group students by progress ranges
      const progressRanges = {
        '0-25': 0,
        '25-50': 0,
        '50-75': 0,
        '75-100': 0
      };

      allStudents.forEach(student => {
        const progress = student.progress || 0;
        if (progress <= 25) progressRanges['0-25']++;
        else if (progress <= 50) progressRanges['25-50']++;
        else if (progress <= 75) progressRanges['50-75']++;
        else progressRanges['75-100']++;
      });

      progressChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['0-25%', '25-50%', '50-75%', '75-100%'],
          datasets: [{
            label: 'Number of Students',
            data: [progressRanges['0-25'], progressRanges['25-50'], progressRanges['50-75'], progressRanges['75-100']],
            backgroundColor: [
              '#dc3545',
              '#ffc107',
              '#17a2b8',
              '#28a745'
            ],
            borderColor: [
              '#c82333',
              '#e0a800',
              '#138496',
              '#1e7e34'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Students'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Progress Range'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: 'Student Progress Distribution'
            }
          }
        }
      });
    }

    // Filter students
    function filterStudents() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const progressFilter = document.getElementById('progressFilter').value;

      const filteredStudents = allStudents.filter(student => {
        // Search filter
        const matchesSearch = student.name.toLowerCase().includes(searchTerm) ||
          student.email.toLowerCase().includes(searchTerm);

        // Progress filter
        let matchesProgress = true;
        if (progressFilter !== 'all') {
          const [min, max] = progressFilter.split('-').map(Number);
          matchesProgress = student.progress >= min && student.progress <= max;
        }

        return matchesSearch && matchesProgress;
      });

      // Update display
      const studentsGrid = document.getElementById('studentsGrid');
      studentsGrid.innerHTML = '';

      filteredStudents.forEach(student => {
        const card = document.createElement('div');
        card.className = 'student-card';
        card.innerHTML = `
                    <div class="student-header">
                        <div>
                            <div class="student-name">${student.name}</div>
                            <div class="student-email">${student.email}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #2c3e50;">${student.progress || 0}%</div>
                            <div style="font-size: 0.8rem; color: #6c757d;">Progress</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${student.progress || 0}%">${student.progress || 0}%</div>
                    </div>
                    <div class="student-stats">
                        <span>Submissions: ${student.totalSubmissions || 0}</span>
                        <span>Last: ${student.lastSubmission ? new Date(student.lastSubmission).toLocaleDateString() : 'Never'}</span>
                    </div>
                `;
        studentsGrid.appendChild(card);
      });
    }

    // Export data
    function exportData() {
      try {
        const csvContent = generateCSV();
        const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);

        link.setAttribute('href', url);
        link.setAttribute('download', `igcse_progress_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showStatus('Data exported successfully!', 'success');
      } catch (error) {
        console.error('Export error:', error);
        showStatus('Failed to export data.', 'error');
      }
    }

    // Generate CSV content
    function generateCSV() {
      const headers = ['Name', 'Email', 'Progress %', 'Total Submissions', 'Last Submission', 'Registration Date'];
      const rows = allStudents.map(student => [
        student.name,
        student.email,
        student.progress || 0,
        student.totalSubmissions || 0,
        student.lastSubmission ? new Date(student.lastSubmission).toLocaleDateString() : 'Never',
        student.registration_date ? new Date(student.registration_date).toLocaleDateString() : 'Unknown'
      ]);

      return [headers, ...rows]
        .map(row => row.map(cell => `"${cell}"`).join(','))
        .join('\n');
    }

    // Show status message
    function showStatus(message, type) {
      // Create status element if it doesn't exist
      let statusElement = document.getElementById('statusMessage');
      if (!statusElement) {
        statusElement = document.createElement('div');
        statusElement.id = 'statusMessage';
        statusElement.className = 'status-message';
        document.querySelector('.dashboard-content').prepend(statusElement);
      }

      statusElement.textContent = message;
      statusElement.className = 'status-message';
      statusElement.classList.add('status-' + type);

      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          statusElement.textContent = '';
          statusElement.className = 'status-message';
        }, 5000);
      }
    }

    // Handle backend connection errors
    function handleBackendError(error) {
      console.error('Backend connection error:', error);
      if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
        showStatus('Cannot connect to backend server. Please ensure the Flask server is running.', 'error');
      } else {
        showStatus('Backend error: ' + error.message, 'error');
      }
    }

    // Auto-refresh data every 5 minutes
    setInterval(() => {
      if (currentUser) {
        loadDashboardData();
      }
    }, 5 * 60 * 1000);
  </script>
</body>

</html>
